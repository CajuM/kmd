.extern apic_regs

.macro ientry interrupt err=0
.global do_int\interrupt
.type do_int\interrupt, %function
do_int\interrupt:
	.if \err == 1
	.else
	pushq $0x00
	.endif

	pushq %rax
	pushq %rbx
	pushq %rcx
	pushq %rdx
	pushq %rbp
	pushq %rdi
	pushq %rsi
	pushq %r8
	pushq %r9
	pushq %r10
	pushq %r11
	pushq %r12
	pushq %r13
	pushq %r14
	pushq %r15

	cld
	movq $\interrupt, %rdi
	movq 120(%rsp), %rsi
	movabs $do_int, %rax
	call *%rax

	popq %r15
	popq %r14
	popq %r13
	popq %r12
	popq %r11
	popq %r10
	popq %r9
	popq %r8
	popq %rsi
	popq %rdi
	popq %rbp
	popq %rdx
	popq %rcx
	popq %rbx
	popq %rax

	addq $8, %rsp

	iretq
.endm

ientry 0x00
ientry 0x01
ientry 0x02
ientry 0x03
ientry 0x04
ientry 0x05
ientry 0x06
ientry 0x07
ientry 0x08
ientry 0x09
ientry 0x0A
ientry 0x0B
ientry 0x0C
ientry 0x0D
ientry 0x0E err=1
ientry 0x0F

ientry 0x10
ientry 0x11
ientry 0x12
ientry 0x13
ientry 0x14
ientry 0x15
ientry 0x16
ientry 0x17
ientry 0x18
ientry 0x19
ientry 0x1A
ientry 0x1B
ientry 0x1C
ientry 0x1D
ientry 0x1E
ientry 0x1F

ientry 0x20
ientry 0x21
ientry 0x22
ientry 0x23
ientry 0x24
ientry 0x25
ientry 0x26
ientry 0x27
ientry 0x28
ientry 0x29
ientry 0x2A
ientry 0x2B
ientry 0x2C
ientry 0x2D
ientry 0x2E
ientry 0x2F

ientry 0x30
ientry 0x31
ientry 0x32
ientry 0x33
ientry 0x34
ientry 0x35
ientry 0x36
ientry 0x37
ientry 0x38
ientry 0x39
ientry 0x3A
ientry 0x3B
ientry 0x3C
ientry 0x3D
ientry 0x3E
ientry 0x3F

ientry 0x40
ientry 0x41
ientry 0x42
ientry 0x43
ientry 0x44
ientry 0x45
ientry 0x46
ientry 0x47
ientry 0x48
ientry 0x49
ientry 0x4A
ientry 0x4B
ientry 0x4C
ientry 0x4D
ientry 0x4E
ientry 0x4F

ientry 0x50
ientry 0x51
ientry 0x52
ientry 0x53
ientry 0x54
ientry 0x55
ientry 0x56
ientry 0x57
ientry 0x58
ientry 0x59
ientry 0x5A
ientry 0x5B
ientry 0x5C
ientry 0x5D
ientry 0x5E
ientry 0x5F

ientry 0x60
ientry 0x61
ientry 0x62
ientry 0x63
ientry 0x64
ientry 0x65
ientry 0x66
ientry 0x67
ientry 0x68
ientry 0x69
ientry 0x6A
ientry 0x6B
ientry 0x6C
ientry 0x6D
ientry 0x6E
ientry 0x6F

ientry 0x70
ientry 0x71
ientry 0x72
ientry 0x73
ientry 0x74
ientry 0x75
ientry 0x76
ientry 0x77
ientry 0x78
ientry 0x79
ientry 0x7A
ientry 0x7B
ientry 0x7C
ientry 0x7D
ientry 0x7E
ientry 0x7F

ientry 0x80
ientry 0x81
ientry 0x82
ientry 0x83
ientry 0x84
ientry 0x85
ientry 0x86
ientry 0x87
ientry 0x88
ientry 0x89
ientry 0x8A
ientry 0x8B
ientry 0x8C
ientry 0x8D
ientry 0x8E
ientry 0x8F

ientry 0x90
ientry 0x91
ientry 0x92
ientry 0x93
ientry 0x94
ientry 0x95
ientry 0x96
ientry 0x97
ientry 0x98
ientry 0x99
ientry 0x9A
ientry 0x9B
ientry 0x9C
ientry 0x9D
ientry 0x9E
ientry 0x9F

ientry 0xA0
ientry 0xA1
ientry 0xA2
ientry 0xA3
ientry 0xA4
ientry 0xA5
ientry 0xA6
ientry 0xA7
ientry 0xA8
ientry 0xA9
ientry 0xAA
ientry 0xAB
ientry 0xAC
ientry 0xAD
ientry 0xAE
ientry 0xAF

ientry 0xB0
ientry 0xB1
ientry 0xB2
ientry 0xB3
ientry 0xB4
ientry 0xB5
ientry 0xB6
ientry 0xB7
ientry 0xB8
ientry 0xB9
ientry 0xBA
ientry 0xBB
ientry 0xBC
ientry 0xBD
ientry 0xBE
ientry 0xBF

ientry 0xC0
ientry 0xC1
ientry 0xC2
ientry 0xC3
ientry 0xC4
ientry 0xC5
ientry 0xC6
ientry 0xC7
ientry 0xC8
ientry 0xC9
ientry 0xCA
ientry 0xCB
ientry 0xCC
ientry 0xCD
ientry 0xCE
ientry 0xCF

ientry 0xD0
ientry 0xD1
ientry 0xD2
ientry 0xD3
ientry 0xD4
ientry 0xD5
ientry 0xD6
ientry 0xD7
ientry 0xD8
ientry 0xD9
ientry 0xDA
ientry 0xDB
ientry 0xDC
ientry 0xDD
ientry 0xDE
ientry 0xDF

ientry 0xE0
ientry 0xE1
ientry 0xE2
ientry 0xE3
ientry 0xE4
ientry 0xE5
ientry 0xE6
ientry 0xE7
ientry 0xE8
ientry 0xE9
ientry 0xEA
ientry 0xEB
ientry 0xEC
ientry 0xED
ientry 0xEE
ientry 0xEF

ientry 0xF0
ientry 0xF1
ientry 0xF2
ientry 0xF3
ientry 0xF4
ientry 0xF5
ientry 0xF6
ientry 0xF7
ientry 0xF8
ientry 0xF9
ientry 0xFA
ientry 0xFB
ientry 0xFC
ientry 0xFD
ientry 0xFE
ientry 0xFF
